// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

type Profile {
  firstName String
  lastName  String
}

type Social {
  instagram String?
  facebook  String?
  other     String?
}

enum ExpenseKind {
  RENT
  COMMUNAL
  MARKETING
  CONSUMABLES
  OTHER
}

enum RecordStatus {
  PENDING
  APPROVED
  CANCELLED
}

// enum Color {
//   Red
//   Green
//   Blue
// }

// enum Size {
//   Small
//   Medium
//   Large
//   XLarge
// }

// type IncomeKind {
//   colors Color[]
//   sizes  Size[]
// }

// type Subtype {
//   NPB
//   Nogu
//   ryku
//   fgklfjdglkd
//   dfgd
//   dfgddfg
//   dfgddfgd
//   hgh
//   lfk
//   dfgddfgdfg
//   ss
//   othrt
// }

// todo - price list editiong
// todo - structure editing with procedures etc 
// todo enum of 2 objects Brows and Laser 
enum IncomeKind {
  BROWS
  LASER
  OTHER
}

model User {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  email        String     @unique
  passwordHash String
  profile      Profile
  expenses     Expense[]  @relation("MyExpense")
  incomes      Income[]   @relation("MyIncome")
  clients      Client[]   @relation("MyClient")
  records      Record[]   @relation("MyRecord")
  businesses   Business[] @relation("MyBusiness")
  // total        Total?    @relation("MyTotal")
  Record       Record[]
}

// todo - remove "?"  and remove prisma migrate history to fix it

model Expense {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  createdTime String
  owner       User        @relation(references: [id], fields: [ownerId], "MyExpense")
  ownerId     String      @db.ObjectId
  type        ExpenseKind @default(OTHER)
  description String?
  value       Int
}

model Income {
  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  createdTime String
  owner       User       @relation(references: [id], fields: [ownerId], "MyIncome")
  ownerId     String     @db.ObjectId
  type        IncomeKind @default(OTHER)
  description String?
  value       Int
}

model Client {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  firstName   String
  lastName    String
  birthday    String?
  phone       String?
  social      Social?
  description String?
  priceLevel  String?
  owner       User     @relation(references: [id], fields: [ownerId], "MyClient")
  ownerId     String   @db.ObjectId
  records     Record[] @relation("ClientRecord")
  // status vip/ new/ old
  // privedy podrugu kto i kogo
  // if abonement calculate how mush free or discounted procedurs left
}

model Record {
  id               String       @id @default(auto()) @map("_id") @db.ObjectId
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  plannedStartTime String
  plannedEndTime   String
  status           RecordStatus @default(PENDING)
  owner            User         @relation(references: [id], fields: [ownerId], "MyRecord")
  ownerId          String       @db.ObjectId
  client           Client       @relation(references: [id], fields: [clientId], "ClientRecord")
  clientId         String       @db.ObjectId
  type             String
  // in future type will be manually created enum
  description      String?
  price            Int
  // todo !!!!!!!!!!!!!!! connect to income ??? when status changed
  // todo auto calculate price form client type and all prices
  // todo !! add semi-automatic planned end time
  User             User?        @relation(fields: [userId], references: [id])
  userId           String?      @db.ObjectId
}

// service - nbp, nogy etc
// level 2
model Service {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  price      Int
  business   Business @relation(references: [id], fields: [businessId], "MyService")
  businessId String   @db.ObjectId
}

// business - laser, electroepil
// level 1
model Business {
  id       String    @id @default(auto()) @map("_id") @db.ObjectId
  name     String
  services Service[] @relation("MyService")
  owner    User      @relation(references: [id], fields: [ownerId], "MyBusiness")
  ownerId  String    @db.ObjectId
}

// todo - connect client to journal record
// model Total {
//   id        String   @id @default(auto()) @map("_id") @db.ObjectId
//   createdAt DateTime @default(now())
//   updatedAt DateTime @updatedAt
//   owner     User     @relation(references: [id], fields: [ownerId], "MyTotal")
//   ownerId   String   @unique @db.ObjectId
//   incomes   Int
//   expenses  Int
// }

// createdTime change to DateTime Format not String. String is temporary solution
// todo - type Date to createdTime to return object, not string
// todo - use float instead of int ???
// todo - add document type - TOTAL (Balance)

// todo - add clients graphic
// todo - add clients relations to Income

// todo - do it will be right to fetch all income values and expense values  or create computed total document ??????
// todo - if we use this variant how to cache data ?? save to state etc ??? update (or update manually) only at crud operations with transactions?? 

// todo - admin with posibility to create different type of proceeds, manage prices and aproximately time 

// structure of admin panel
// 1) business - types of procedure (name, price)
